<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libnxter: Odometer2.nxc File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Odometer2.nxc File Reference</h1>Implements odometery for 2 wheels drive robot base using motor tachometers. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="_debug_8nxc-source.html">Debug.nxc</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_vector_8nxc-source.html">Vector.nxc</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_map_8nxc-source.html">Map.nxc</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for Odometer2.nxc:</div>
<div class="dynsection">
<p><center><img src="_odometer2_8nxc__incl.png" border="0" usemap="#Odometer2.nxc_map" alt=""></center>
<map name="Odometer2.nxc_map">
<area shape="rect" href="_debug_8nxc.html" title="Debugging utility macros." alt="" coords="83,379,165,405"><area shape="rect" href="_vector_8nxc.html" title="A simple 3&#45;components vector implementation (2D point + direction)." alt="" coords="69,229,152,256"><area shape="rect" href="_map_8nxc.html" title="A 2D map implementation that holds a set of landmark objects." alt="" coords="127,80,199,107"><area shape="rect" href="_matrix_8nxc.html" title="Integer matrix implementation. Provides matrix algebra, cofactor, adjugate and inverse..." alt="" coords="123,304,205,331"><area shape="rect" href="_screen_8nxc.html" title="Display functions for text and graphs." alt="" coords="148,155,236,181"><area shape="rect" href="_angle_8nxc.html" title="Provides simple arithmetic for absolute and relative angles." alt="" coords="225,229,305,256"></map>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="_odometer2_8nxc__dep__incl.png" border="0" usemap="#Odometer2.nxcdep_map" alt=""></center>
<map name="Odometer2.nxcdep_map">
<area shape="rect" href="_example_8nxc-source.html" title="Example.nxc" alt="" coords="12,155,108,181"><area shape="rect" href="_vehicle_8nxc.html" title="A simple 2 wheels drive vehicle implementation that can travel a set of navigation..." alt="" coords="57,80,145,107"></map>
</div>

<p>
<a href="_odometer2_8nxc-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_odometer2.html">Odometer2</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Odometer class for 2 wheels drive robot base that desribes wheel anatomy and positional integration.  <a href="struct_odometer2.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">safecall void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#712b8144e210a1c969326e9a6e87b999">Odometer2Step</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> &amp;wheelBase)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates current odometry position.  <a href="#712b8144e210a1c969326e9a6e87b999"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#4447dd77b38873f5c080dbe1eb9931d6">Odometer2Init</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> &amp;wheelBase, int leftWheelMotor, int rightWheelMotor, int axialLength, int wheelDiameter, int gearRatio, int initialLeftTacho, int initialRightTacho, bool enableDPosition, bool enableDeltaPosition)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a 2 wheel drive odometer.  <a href="#4447dd77b38873f5c080dbe1eb9931d6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="60a62de9fc10669c935667a0f81655f8"></a><!-- doxytag: member="Odometer2.nxc::Odometer2GetCumulativePosition" ref="60a62de9fc10669c935667a0f81655f8" args="(Odometer2 odometer, Vector &amp;retPosition)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#60a62de9fc10669c935667a0f81655f8">Odometer2GetCumulativePosition</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> odometer, <a class="el" href="struct_vector.html">Vector</a> &amp;retPosition)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets current cumulative position; position relative to the initial robot position (usually origin in world coordinate). <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2875db41b688570c269802ef956b6b0b"></a><!-- doxytag: member="Odometer2.nxc::Odometer2GetCumulativeSamplesCount" ref="2875db41b688570c269802ef956b6b0b" args="(Odometer2 odometer)" -->
long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#2875db41b688570c269802ef956b6b0b">Odometer2GetCumulativeSamplesCount</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> odometer)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets the total number of sample counts used in cumulative position integration. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0bba4a0c346b5d1a09207f09097d4ea0"></a><!-- doxytag: member="Odometer2.nxc::Odometer2GetDeltaPosition" ref="0bba4a0c346b5d1a09207f09097d4ea0" args="(Odometer2 odometer, Vector &amp;retPosition)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#0bba4a0c346b5d1a09207f09097d4ea0">Odometer2GetDeltaPosition</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> odometer, <a class="el" href="struct_vector.html">Vector</a> &amp;retPosition)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets delta position integration; current position relative to the position when drift was corrected and delta cleared. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d2f3346281dc172697c0f8419a4ad957"></a><!-- doxytag: member="Odometer2.nxc::Odometer2GetDeltaSamplesCount" ref="d2f3346281dc172697c0f8419a4ad957" args="(Odometer2 odometer)" -->
long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#d2f3346281dc172697c0f8419a4ad957">Odometer2GetDeltaSamplesCount</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> odometer)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets samples count used in current deta integration. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_odometer2_8nxc.html#50128c61fb512fa583722766384cd3f1">Odometer2SetDriftCorrection</a> (<a class="el" href="struct_odometer2.html">Odometer2</a> odometer, <a class="el" href="struct_vector.html">Vector</a> &amp;correction, <a class="el" href="struct_vector.html">Vector</a> &amp;retDeltaPosition)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Corrects odometery drift at the position when last drift was corrected.  <a href="#50128c61fb512fa583722766384cd3f1"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Implements odometery for 2 wheels drive robot base using motor tachometers. 
<p>
It maintains an integration of robot position based on peridic samples of tacho counts. Once the odometer is initialized, odometer2Step() needs to be called at regular interval (does not have to be precise intervals). 
<p>Definition in file <a class="el" href="_odometer2_8nxc-source.html">Odometer2.nxc</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="4447dd77b38873f5c080dbe1eb9931d6"></a><!-- doxytag: member="Odometer2.nxc::Odometer2Init" ref="4447dd77b38873f5c080dbe1eb9931d6" args="(Odometer2 &amp;wheelBase, int leftWheelMotor, int rightWheelMotor, int axialLength, int wheelDiameter, int gearRatio, int initialLeftTacho, int initialRightTacho, bool enableDPosition, bool enableDeltaPosition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Odometer2Init           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_odometer2.html">Odometer2</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>wheelBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>leftWheelMotor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rightWheelMotor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>axialLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wheelDiameter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gearRatio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>initialLeftTacho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>initialRightTacho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>enableDPosition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>enableDeltaPosition</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initializes a 2 wheel drive odometer. 
<p>
leftWheelMotor and rightWheelMotor are the left wheel and right wheel motors, wheelDiameter is the diameter of the wheels (in mm), gearRatio is the ratio of wheel rotational angle per tacho count (scaled by 100), initialLeftTacho and initialRightTahoc are the initial tacho counts. If enableDPosition is set true, it also maintains dx of current step, i.e. change in position since last step. If enableDeltaPosition is enabled, it also maintains deltaX, which is the position changed since last deta was cleared. 
<p>Definition at line <a class="el" href="_odometer2_8nxc-source.html#l00170">170</a> of file <a class="el" href="_odometer2_8nxc-source.html">Odometer2.nxc</a>.</p>

<p>References <a class="el" href="_odometer2_8nxc-source.html#l00052">Odometer2::axialLength</a>, <a class="el" href="_odometer2_8nxc-source.html#l00058">Odometer2::cumulativePosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00060">Odometer2::cumulativeSamplesCount</a>, <a class="el" href="_odometer2_8nxc-source.html#l00059">Odometer2::cumulativeTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00064">Odometer2::deltaPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00066">Odometer2::deltaSamplesCount</a>, <a class="el" href="_odometer2_8nxc-source.html#l00065">Odometer2::deltaTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00070">Odometer2::dPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00071">Odometer2::dTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00063">Odometer2::enableDeltaPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00069">Odometer2::enableDPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00053">Odometer2::gearRatio</a>, <a class="el" href="_odometer2_8nxc-source.html#l00079">Odometer2::lastSampleTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00077">Odometer2::lastTachoLeft</a>, <a class="el" href="_odometer2_8nxc-source.html#l00078">Odometer2::lastTachoRight</a>, <a class="el" href="_odometer2_8nxc-source.html#l00054">Odometer2::leftWheelMotor</a>, <a class="el" href="_odometer2_8nxc-source.html#l00055">Odometer2::rightWheelMotor</a>, <a class="el" href="_odometer2_8nxc-source.html#l00074">Odometer2::speed</a>, <a class="el" href="_vector_8nxc-source.html#l00122">VectorInit()</a>, and <a class="el" href="_odometer2_8nxc-source.html#l00051">Odometer2::wheelDiameter</a>.</p>

</div>
</div><p>
<a class="anchor" name="50128c61fb512fa583722766384cd3f1"></a><!-- doxytag: member="Odometer2.nxc::Odometer2SetDriftCorrection" ref="50128c61fb512fa583722766384cd3f1" args="(Odometer2 odometer, Vector &amp;correction, Vector &amp;retDeltaPosition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Odometer2SetDriftCorrection           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_odometer2.html">Odometer2</a>&nbsp;</td>
          <td class="paramname"> <em>odometer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_vector.html">Vector</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>correction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_vector.html">Vector</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>retDeltaPosition</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Corrects odometery drift at the position when last drift was corrected. 
<p>
The given correction vector is considered the corrected robot position at the time when delta was cleared (last drift correction). So, corrected commulative position is this vector plus the delta position. Current delta position is properly translated and added to corrected position to get current cumulative position. Delta is clear after the drift correction and its last value passed to retDeltaPosition. 
<p>Definition at line <a class="el" href="_odometer2_8nxc-source.html#l00249">249</a> of file <a class="el" href="_odometer2_8nxc-source.html">Odometer2.nxc</a>.</p>

<p>References <a class="el" href="_odometer2_8nxc-source.html#l00058">Odometer2::cumulativePosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00064">Odometer2::deltaPosition</a>, <a class="el" href="_vector_8nxc-source.html#l00047">Vector::theta</a>, <a class="el" href="_vector_8nxc-source.html#l00076">VectorGetDistance()</a>, <a class="el" href="_vector_8nxc-source.html#l00122">VectorInit()</a>, and <a class="el" href="_vector_8nxc-source.html#l00163">VectorTranslate()</a>.</p>

</div>
</div><p>
<a class="anchor" name="712b8144e210a1c969326e9a6e87b999"></a><!-- doxytag: member="Odometer2.nxc::Odometer2Step" ref="712b8144e210a1c969326e9a6e87b999" args="(Odometer2 &amp;wheelBase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">safecall void Odometer2Step           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_odometer2.html">Odometer2</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>wheelBase</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Updates current odometry position. 
<p>
Computes the amount by which wheel base moved from the change in tacho counts of its two motors and updates its intergral states.<p>
This function should be called at regular intervals, not neccessarily at precise intervals, to keep odometer up to date. It firsts computes current change in position since last step (dx) and updates commulative and detla position integrals. 
<p>Definition at line <a class="el" href="_odometer2_8nxc-source.html#l00093">93</a> of file <a class="el" href="_odometer2_8nxc-source.html">Odometer2.nxc</a>.</p>

<p>References <a class="el" href="_odometer2_8nxc-source.html#l00052">Odometer2::axialLength</a>, <a class="el" href="_odometer2_8nxc-source.html#l00058">Odometer2::cumulativePosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00060">Odometer2::cumulativeSamplesCount</a>, <a class="el" href="_odometer2_8nxc-source.html#l00059">Odometer2::cumulativeTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00064">Odometer2::deltaPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00066">Odometer2::deltaSamplesCount</a>, <a class="el" href="_odometer2_8nxc-source.html#l00065">Odometer2::deltaTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00070">Odometer2::dPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00071">Odometer2::dTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00063">Odometer2::enableDeltaPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00069">Odometer2::enableDPosition</a>, <a class="el" href="_odometer2_8nxc-source.html#l00053">Odometer2::gearRatio</a>, <a class="el" href="_odometer2_8nxc-source.html#l00079">Odometer2::lastSampleTime</a>, <a class="el" href="_odometer2_8nxc-source.html#l00077">Odometer2::lastTachoLeft</a>, <a class="el" href="_odometer2_8nxc-source.html#l00078">Odometer2::lastTachoRight</a>, <a class="el" href="_odometer2_8nxc-source.html#l00054">Odometer2::leftWheelMotor</a>, <a class="el" href="_odometer2_8nxc-source.html#l00055">Odometer2::rightWheelMotor</a>, <a class="el" href="_odometer2_8nxc-source.html#l00074">Odometer2::speed</a>, <a class="el" href="_vector_8nxc-source.html#l00047">Vector::theta</a>, <a class="el" href="_odometer2_8nxc-source.html#l00051">Odometer2::wheelDiameter</a>, <a class="el" href="_vector_8nxc-source.html#l00045">Vector::x</a>, and <a class="el" href="_vector_8nxc-source.html#l00046">Vector::y</a>.</p>

<p>Referenced by <a class="el" href="_vehicle_8nxc-source.html#l00212">VehicleSteerToAngle()</a>, and <a class="el" href="_vehicle_8nxc-source.html#l00384">VehicleStep()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Jun 6 15:09:09 2009 for libnxter by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
